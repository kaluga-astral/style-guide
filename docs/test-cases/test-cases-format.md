---
sidebar_position: 2
---

## Формирование тест-кейсов

Формирование тест-кейсов - это не тривиальная задача.

Единый формат призван упростить процесс формирования тест-кейсов.

Единый формат позволяет:

- Упростить процесс формирования тест-кейсов
- Увеличить  качество тест-кейсов, отвечая каждый раз на необходимые вопросы при формировании тест-кейсов

## Формат

Каждый тест-кейс должен строиться по формуле:

```ts
it('ПРЕДМЕТ_ТЕСТИРОВАНИЯ + ОЖИДАЕМЫЙ_РЕЗУЛЬТАТ + УСЛОВИЕ')
```

### Примеры

- `Общий счетчик товаров увеличивается при добавлении товаров в корзину`
- `Процесс оплаты запускается фоном при открытии модалки`
- `В результирующую строку добавляется постфикс`
- `Value "%s" невалидно, если не является строкой`
- `Дефолтный message переопределяется через параметры`
- `Контент отображается по нажатию на title`
- `Тэг блокируется при disabled=true`
- `onChange вызывается при нажатии на тэг`

#### ПРЕДМЕТ_ТЕСТИРОВАНИЯ

При выборе предмета тестирования необходимо понять **ЧТО** мы собираемся проверять на какой объект (предмет) направлена проверка. 

Примеры предмета тестирования:

- `Общий счетчик товаров` увеличивается при добавлении товаров в корзину
- `Процесс оплаты` запускается фоном при открытии модалки
- `В результирующую строку` добавляется постфикс
- `Value "%s"` невалидно, если не является строкой
- `Дефолтный message` переопределяется через параметры
- `Контент` отображается по нажатию на title
- `Тэг` блокируется при disabled=true
- `onChange` вызывается при нажатии на тэг

#### ОЖИДАЕМЫЙ_РЕЗУЛЬТАТ

Вторая часть тест-кейса обязательно должна указывать на ожидаемый результат. Ожидаемый результат может быть действием, состоянием, побочным эффектом.

Примеры ожидаемого результат:

- Общий счетчик товаров `увеличивается` при добавлении товаров в корзину
- Процесс оплаты `запускается фоном` при открытии модалки
- В результирующую строку `добавляется постфикс`
- Value "%s" `невалидно`, если не является строкой
- Дефолтный message `переопределяется` через параметры
- Контент `отображается` по нажатию на title
- Тэг `блокируется` при disabled=true
- onChange `вызывается` при нажатии на тэг

#### УСЛОВИЕ

Условие - опциональный блок.

Примеры условий:

- Общий счетчик товаров увеличивается `при добавлении товаров в корзину`
- Процесс оплаты запускается фоном `при открытии модалки`
- Value "%s" невалидно, `если не является строкой`
- Дефолтный message переопределяется `через параметры`
- Контент отображается `по нажатию на title`
- Тэг блокируется `при disabled=true`
- onChange вызывается `при нажатии на тэг`

---

## Группировка тест-кейсов

Допускается группировка тест-кейсов по **предмету тестирования и условию.**

**Пример группировки по предмету тестирования:**

```ts
describe('Общий счетчик товаров', () => {
  it('Увеличивается при добавлении товаров до успешного выполнения запроса');

  it(
    'Откатывается в исходное при ошибке запроса на добавления товаров в корзину',
  );

  it('Уменьшается при удалении товаров до успешного выполнения запроса');

  it(
    'Откатывается в исходное при ошибке запроса на удаление товаров из корзины',
  );
});
```

**Пример группировки по условию:**

```ts
describe('Query', () => {
  describe('При возникновении ошибки', () => {
    it('onError вызывается с текстом ошибки');

    it('Статусные флаги устанавливаются в error state');

    it('Сбрасывается data');
  });
});
```

---

## Тестирование бизнес-логики

В [Astral Architecture Guide](https://www.notion.so/Astral-Frontend-Architecture-Guide-cbb7ccaa69384c65aec35292a5c13e2a?pvs=21) бизнес-логика находится в слоях: `Data` и `Modules`.

#### На основе постановки задачи

**Тест-кейсы для бизнес-логики должны  основываться на постановке задачи**, которую реализовали аналитики.

Постановка к задаче, как правило, содержит **предмет тестирования**, **ожидаемый результат** и **условие**.

#### На основе приемочных тест-кейсов

Часть тест-кейсов может быть основана на приемочных кейсах, которые описали QA для задачи.

#### Рекомендации

В тест-кейсах необходимо избегать прямое использование названий методов и свойств SUT.
Использование названий и методов SUT раскрывает детали реализации бизнес-требований, это приводит к хрупким тестам.

---

### Тестирование инфраструктурного кода

В [Astral Architecture Guide](https://www.notion.so/Astral-Frontend-Architecture-Guide-cbb7ccaa69384c65aec35292a5c13e2a?pvs=21) инфраструктурный код находится в слое `shared`.

Формирование тест-кейсов должно происходит на основе:

- Доступных инвариантов состояния

```ts
it('isSuccess переключается в true после успешного выполнения запроса')
```

- Доступного поведения

```ts
it('Контент отображается по нажатию на header')
```

- Реакции на входные параметры

```ts
it('Контент отображается при isExpanded=true')
```

---

## Тестирование на основе массива входных значений. Использование it.each

Для проверки поведение SUT на основе массива входных данных используется `it.each`.

При использовании `it.each` условие обязательно должно присутствовать:

```ts
it.each(['', '9', '92', '921', '92176'])(
  'Value "%s" невалидно, если длина поля не равна 4 символам'
);
```
